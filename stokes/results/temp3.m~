close all
% clear all
clc


filename = 'out_original_B.dat';
Bo  = spconvert(load(filename));
filename = 'out_original_F.dat';
Fo  = spconvert(load(filename));
filename = 'out_original_M.dat';
Mo  = spconvert(load(filename));

filename = 'out_final_B.dat';
Bd  = spconvert(load(filename));
filename = 'out_final_F.dat';
Fd  = spconvert(load(filename));
filename = 'out_final_M.dat';
Md  = spconvert(load(filename));

nu = size(Fo,1);
np = size(Bo,1);
NT = 3;
Nu = nu*NT;
Np = np*NT;

Zuu = sparse(nu,nu);
Zpp = sparse(np,np);
Zup = sparse(nu,np);
Zpu = sparse(np,nu);


FF = [Fd, Zuu, Zuu;...
	    Md,  Fd, Zuu;...
			Zuu, Md, Fd ];
BB = [Bd,  Zpu, Zpu;...
	    Zpu,  Bd, Zpu;...
			Zpu, Zpu, Bd ];

A = [FF, BB';...
	   BB, sparse(Np,Np)];
	 
FFo = [Fo, Zuu, Zuu;...
	     Mo,  Fo, Zuu;...
			Zuu,  Mo, Fo ];
BBo = [Bo,  Zpu, Zpu;...
	     Zpu,  Bo, Zpu;...
			 Zpu, Zpu, Bo ];

Ao = [FFo, BBo';...
	    BBo, sparse(Np,Np)];
 

rhs0 = [0.433333 -0.0111111 0.433333 -0.0111111 0.266667 0.0888889 0.133333 0.0888889 1.91111 0.444444 -1.66533e-16 -0.444444 1.66533e-16 0 0.888889 0 -0.888889 0 0.444444 0 0.444444 0 0 0 0 0 1.77778 0.444444 -1.66533e-16 -0.444444 1.66533e-16 0 0.888889 0 -0.888889 0 0.444444 0 0.444444 0 0 0 0 0 1.77778 0.444444 -1.66533e-16 -0.444444 1.66533e-16 0 0.888889 0 -0.888889 0 0 0 0 0 0 0 0 0 0 0 0 0]';
rhs  = [0 0 0 0 0.666667 0 0.133333 0 0.977778 0 0 0 0 0 0 0 0 0 0 0 0 0 0.444444 0 0 0 0.977778 0 0 0 0 0 0 0 0 0 0 0 0 0 0.444444 0 0 0 0.977778 0 0 0 0 0 0 0 0 0 -0.111111 0 -0.0555556 -0.0555556 -0.111111 0 -0.0555556 -0.0555556 -0.111111 0 -0.0555556 -0.0555556]';

essNodesV = [1:4,6,8:13,15,17,18];
uBC = zeros(nu,1); uBC(9) = 1;

uga = rhs0;

for i=0:NT-1
	if i==1
		uga( essNodesV + (i*nu) )  = uga( essNodesV + (i*nu) )   - Fo*uBC;
	if 
	uga( nu*NT + i*np + 1:np ) = uga( nu*NT + i*np + 1:np )) - Bo*uBC;
end

dirichlet = repmat(-Fo*uBC, [NT,1]);
dirichlet(nu+1:end) = dirichlet(nu+1:end) + repmat(-Mo*uBC,[NT-1,1]);

uga = rhs0 + dirichlet - rhs(1:(NT*nu));
diagFo = full(diag(Fo));
for i=0:NT-1
	uga( essNodesV + (i*nu) ) = diagFo(essNodesV).*uBC(essNodesV);
end


% nFile = 10;
% rhsu = load([frhs,  '0.dat']);
% igu  = load([fuig,  '0.dat']);
% usol = load([fusol, '0.dat.0']);
% 
% rhsu = zeros( NT*nu, nFile );
% igu  = zeros( NT*nu, nFile );
% usol = zeros( NT*nu, nFile );
% for i = 0:nFile-1
% 	rhsu(:,i+1) = load([frhs, num2str(i), '.dat']);
% 	igu(:,i+1)  = load([fuig, num2str(i), '.dat']);
% 	for j = 0:NT-1
% 		temp = load([fusol, num2str(i), '.dat.', num2str(j)]);
% 		usol(NX*j+(1:NX),i+1) = temp(2:end);
% 	end
% end







